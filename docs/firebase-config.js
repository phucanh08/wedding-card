import{initializeApp}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";import{addDoc,collection,doc,getDocs,getFirestore,limit,onSnapshot,orderBy,query,serverTimestamp,where}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";const firebaseConfig={apiKey:"AIzaSyDy3QBcu_bEFdiBhRHVGdEi2G5vVdF0wXM",authDomain:"wedding-card-cdcce.firebaseapp.com",databaseURL:"https://wedding-card-cdcce-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"wedding-card-cdcce",storageBucket:"wedding-card-cdcce.appspot.com",messagingSenderId:"985532056221",appId:"1:985532056221:web:cf5177f0b313a04ecb4a74",measurementId:"G-WY6R3LVYX3"},app=initializeApp(firebaseConfig),db=getFirestore(app);async function getAllGuests(){try{const e=query(collection(db,"guests"),orderBy("name")),t=await getDocs(e),n=[];return t.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){throw console.error("Error getting documents: ",e),e}}async function addConfirm(e){try{if(!guestId){const t=serverTimestamp(),n=await addDoc(collection(db,"guests"),{name:e.guestName,createdTime:t});guestId=n.id,currentGuest={id:guestId,name:e.guestName,createdTime:t},guests.push(currentGuest),url.searchParams.append("code",guestId),history.pushState(null,"",url.href)}const t=serverTimestamp();return(await addDoc(collection(db,"rsvp"),{...e,guestId:guestId,_name:currentGuest.name,createdTime:t})).id}catch(e){throw console.error("Error adding document: ",e),e}}async function getConfirm(){try{const e=query(collection(db,"rsvp"),where("guestId","==",guestId),orderBy("createdTime","desc"),limit(1));return(await getDocs(e)).forEach(e=>{rsvpData={id:e.id,...e.data()}}),rsvpData}catch(e){throw console.error("Error adding document: ",e),e}}async function addWish(e){try{const t=serverTimestamp();return(await addDoc(collection(db,"wishes"),{...e,createdTime:t})).id}catch(e){throw console.error("Error adding document: ",e),e}}async function getAllWishes(){try{const e=query(collection(db,"wishes"),orderBy("createdTime","desc")),t=await getDocs(e),n=[];return t.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){throw console.error("Error getting documents: ",e),e}}function setWishesListener(e){const t=query(collection(db,"wishes"),orderBy("createdTime","desc"));return onSnapshot(t,t=>{const n=[];t.forEach(e=>{n.push({id:e.id,...e.data()})}),e(n)})}window.addEventListener("load",function(){if(getAllGuests().then(e=>{guests=e,currentGuest=e.find(e=>e.id===guestId),currentGuest&&(document.getElementById("guest-name").value=currentGuest.name,document.querySelector("#name-comment").value=currentGuest.name,document.querySelector("#title-confirm-id").innerHTML=`Trân trọng kính mời ${currentGuest.name} đến tham dự buổi tiệc chung vui cùng gia đình chúng tôi!`)}),getConfirm().then(e=>{e&&(e.confirmStatus&&(document.getElementById("send-confirm-btn").disabled=!1),document.getElementById("attendance_status_id").value=e.confirmStatus,e.numOfPerson&&(document.getElementById("plus_ones_id").value=e.numOfPerson,document.getElementById("plus_ones_id").style.display=""))}),setWishesListener(e=>{const t=document.getElementById("show-comments");t.innerHTML="",e.forEach((e,n)=>{const o=document.createElement("div");o.className="box-comment pb-3",o.innerHTML=`<div class="box-comment pb-3">\n                        <h4 id="user-name-comment" class="mt-1">${e.name}</h4>\n                        <p id="comment-detail" class="m-0">\n                            <pre style="white-space: pre-wrap; word-wrap: break-word; overflow: hidden;">${e.content}</pre>\n                        </p>\n                    </div>`,t.appendChild(o)})}),$(document).on("click",".buttonDonate",function(){$("#donate-modal").show(),$("body").hasClass("offcanvas")&&($("body").removeClass("offcanvas"),$(".js-oliven-nav-toggle").removeClass("active"))}),$(document).on("click",".donate-modal-close",function(){$("#donate-modal").hide(),$("#rsvp-modal").hide()}),$(document).on("click","body",function(e){e.target.id===$("#donate-modal").attr("id")&&$("#donate-modal").hide(),e.target.id===$("#rsvp-modal").attr("id")&&$("#rsvp-modal").hide()}),$(document).on("click",".crypto-item",function(){let e=$(this).parents(".donate-card");e.find(".cryptos-box-view").show(),e.find(".cryptos-box-view .coin-img").html('<img src="'+$(this).data("img")+'" />'),e.find(".cryptos-box-view .coin-id").html($(this).data("id")),e.find(".cryptos-box-view .coin-address").html($(this).data("address")),e.find(".cryptos-box-view .coin-qr-code").html("").qrcode({width:150,height:150,text:$(this).data("address")})}),$(document).on("click",".cryptos-box-view-close",function(){$(this).parents(".donate-card").find(".cryptos-box-view").hide()}),$(document).on("submit","#rsvp-form",async function(e){try{e.preventDefault();const t={guestName:document.getElementById("guest-name").value.trim()||currentGuest.name,confirmStatus:document.getElementById("attendance_status_id").value,numOfPerson:document.getElementById("plus_ones_id").value};await addConfirm(t),$("#rsvp-modal").hide()}catch(e){}}),$("#wish-form").validate({rules:{name:{required:!0,minlength:5},content:{required:!0,minlength:10},email:{required:!1,email:!0}},errorPlacement:function(e,t){"content"===t.attr("name")?e.insertAfter("#wish-form .vitualTextarea"):e.insertAfter(t)},messages:{name:{required:'<span style="color:red;">Vui lòng nhập tên của bạn.</span>',minlength:'<span style="color:red;">Tên phải lớn hơn 5 ký tự.</span>'},content:{required:'<span style="color:red;">Vui lòng nhập lời chúc.</span>',minlength:'<span style="color:red;">Lời chúc phải lớn hơn 10 ký tự.</span>'},email:{email:'<span style="color:red;">Địa chỉ email không hợp lệ.</span>'}},submitHandler:async function(e,t){try{t.preventDefault();const n={name:document.getElementById("name-comment").value,content:document.getElementById("detail-comment").value};await addWish(n),e.reset()}catch(e){}}}),$(".music-box").length){var e=$(".music-box-toggle-btn"),t=$(".music-holder");e.on("click",function(){return t.toggleClass("toggle-music-box"),!1})}$(".back-to-top-btn").length&&$(".back-to-top-btn").on("click",function(){return $("html,body").animate({scrollTop:0},2e3,"easeInOutExpo"),!1}),$(document).on("click",".calendar-button-custom-click",function(e){e.preventDefault(),$(this).parent().find(".calendar-button .atcb-click").click()}),$(".btn-menu-open").click(function(){$("ul.list-menu-icon").css("opacity","1"),$("ul.list-menu-icon").css("pointer-events",""),$(".btn-menu-close").show(),$(".btn-menu-open").hide()}),$(".btn-menu-close").click(function(){$("ul.list-menu-icon").css("opacity","0"),$("ul.list-menu-icon").css("pointer-events","none"),$(".btn-menu-open").show(),$(".btn-menu-close").hide()}),setTimeout(()=>{$(".btn-menu-open").hide(),$(".btn-menu-close").show(),$("ul.list-menu-icon").css("opacity","1")},3e3),$(window).on("load",function(){$(".bii-logo").length>0&&($("#menu-access").css("bottom","278px"),document.querySelector("style").textContent+="@media (max-width: 799px){#menu-access{bottom: 238px!important;}}")})});